<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ToDos | Pok√©mon Tracker</title>
  <!-- ÂºïÂÖ•Bootswatch: Darkly‰∏ªÈ¢ò -->
  <link href="https://cdn.jsdelivr.net/npm/bootswatch@5.3.0/dist/minty/bootstrap.min.css" rel="stylesheet">
</head>
<body>

<!-- =========================================================== -->
<!-- ÂØºËà™Ê†è -->
<nav class="navbar navbar-expand-lg navbar-dark bg-primary">
  <div class="container-fluid">
    <a class="navbar-brand" href="/">Pok√©mon Tracker</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav me-auto">
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" id="navbarTracking" role="button" data-bs-toggle="dropdown" aria-expanded="false">
            Tracking
          </a>
          <ul class="dropdown-menu" aria-labelledby="navbarTracking">
            <li><a class="dropdown-item" href="/tracking/research">Research</a></li>
            <li><a class="dropdown-item" href="/tracking/habits">Habits</a></li>
            <li><a class="dropdown-item" href="/tracking/todos">To-Dos</a></li>
          </ul>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#">Pok√©dex</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#">Shops</a>
        </li>
      </ul>
    </div>
  </div>
</nav>


<!-- =========================================================== -->
<!-- ‰∏ªÂÜÖÂÆπÂå∫Âüü -->
<div class="container mt-4">
  <h1 class="text-primary mb-4">To-Dos</h1>

  <!-- ‰ªªÂä°ËæìÂÖ•Ê°Ü -->
  <form id="todo-form" class="mb-3">
  <!-- </form> -->
    <div class="input-group d-flex align-items-center">
      <input type="text" class="form-control" id="task-title" placeholder="Task title...">
      <button class="btn btn-secondary" type="button" id="toggle-details">
        Toggle Details
      </button>
      <button class="btn btn-success" type="button" id="add-task">Add Task</button>
    </div>
  </form>

  <!-- ÊòæÁ§∫Êú™ÂÆåÊàêÁöÑ‰ªªÂä° -->
  <div class="accordion mt-4" id="unfinished-task-list">
    <h2 class="d-flex justify-content-between">
      Unfinished
      <!-- ÊéíÂ∫èÊåâÈíÆ -->
      <div class="btn-group" role="group" aria-label="Sorting group">
        <input type="radio" class="btn-check sort-btn" name="unfinished-sort" id="unfinished-sort-btn-created-at" data-sort="created_at" autocomplete="off" checked="">
        <label class="btn btn-outline-light" for="unfinished-sort-btn-created-at">üìÖ</label>

        <input type="radio" class="btn-check sort-btn" name="unfinished-sort" id="unfinished-sort-btn-emergency" data-sort="emergency" autocomplete="off">
        <label class="btn btn-outline-light" for="unfinished-sort-btn-emergency">üî•</label>

        <input type="radio" class="btn-check sort-btn" name="unfinished-sort" id="unfinished-sort-btn-importance" data-sort="importance" autocomplete="off">
        <label class="btn btn-outline-light" for="unfinished-sort-btn-importance">‚≠ê</label>

        <input type="radio" class="btn-check sort-btn" name="unfinished-sort" id="unfinished-sort-btn-difficulty" data-sort="difficulty" autocomplete="off">
        <label class="btn btn-outline-light" for="unfinished-sort-btn-difficulty">üîÆ</label>

        <input type="radio" class="btn-check sort-btn" name="unfinished-sort" id="unfinished-sort-btn-time" data-sort="time" autocomplete="off">
        <label class="btn btn-outline-light" for="unfinished-sort-btn-time">‚è±</label>

        <!-- Ê≠£Â∫è/ÂÄíÂ∫èÊåâÈíÆ -->
        <button class="btn btn-outline-light sort-direction" id="unfinished-sort-direction-btn" data-direction="desc">üîª</button>
      </div>
    </h2>
    <ul class="list-group">
      <!-- Êú™ÂÆåÊàêÁöÑ‰ªªÂä°Â∞ÜÊòæÁ§∫Âú®ËøôÈáå -->
    </ul>
  </div>

  <!-- ÊòæÁ§∫Â∑≤ÂÆåÊàêÁöÑ‰ªªÂä° -->
  <div class="accordion mt-4 mb-5" id="finished-task-list">
    <h2 class="d-flex justify-content-between">
      Finished
      <div class="btn-group" role="group" aria-label="Sorting group">
        <input type="radio" class="btn-check sort-btn" name="finished-sort" id="finished-sort-btn-created-at" data-sort="created_at" autocomplete="off" checked="">
        <label class="btn btn-outline-light" for="finished-sort-btn-created-at">üìÖ</label>

        <input type="radio" class="btn-check sort-btn" name="finished-sort" id="finished-sort-btn-emergency" data-sort="emergency" autocomplete="off">
        <label class="btn btn-outline-light" for="finished-sort-btn-emergency">üî•</label>

        <input type="radio" class="btn-check sort-btn" name="finished-sort" id="finished-sort-btn-importance" data-sort="importance" autocomplete="off">
        <label class="btn btn-outline-light" for="finished-sort-btn-importance">‚≠ê</label>

        <input type="radio" class="btn-check sort-btn" name="finished-sort" id="finished-sort-btn-difficulty" data-sort="difficulty" autocomplete="off">
        <label class="btn btn-outline-light" for="finished-sort-btn-difficulty">üîÆ</label>

        <input type="radio" class="btn-check sort-btn" name="finished-sort" id="finished-sort-btn-time" data-sort="time" autocomplete="off">
        <label class="btn btn-outline-light" for="finished-sort-btn-time">‚è±</label>

        <!-- Ê≠£Â∫è/ÂÄíÂ∫èÊåâÈíÆ -->
        <button class="btn btn-outline-light sort-direction" id="finished-sort-direction-btn" data-direction="desc">üîª</button>
      </div>
    </h2>
    <ul class="list-group">
      <!-- Â∑≤ÂÆåÊàêÁöÑ‰ªªÂä°Â∞ÜÊòæÁ§∫Âú®ËøôÈáå -->
    </ul>
  </div>
</div>


<!-- Á°ÆËÆ§Âà†Èô§ÁöÑÊ®°ÊÄÅÊ°Ü -->
<div class="modal fade" id="modal-delete-confirm" tabindex="-1" aria-labelledby="modal-delete-confirm-label" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="modal-delete-confirm-label">Confirm Deletion</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        Are you sure you want to delete this task?
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-danger" id="confirm-delete-btn">Delete</button>
      </div>
    </div>
  </div>
</div>


<!-- ÈÄöÁî®‰ªªÂä° Modal -->
<div class="modal fade" id="task-modal" tabindex="-1" aria-labelledby="task-modal-label" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="task-modal-label">New Task</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form id="task-form">
          <!-- Title -->
          <div class="mb-3">
            <label for="modal-task-title" class="form-label">Title</label>
            <input type="text" class="form-control" id="modal-task-title" placeholder="Task title...">
          </div>

          <!-- Notes -->
          <div class="mb-3">
            <label for="task-notes" class="form-label">Notes</label>
            <textarea class="form-control" id="task-notes" rows="2" placeholder="‰ªªÂä°Â§áÊ≥®"></textarea>
          </div>

          <!-- Emergency ÈÄâÊã© -->
          <label style="width: 120px" class="me-2">Emergency</label>
          <div class="btn-group my-1" role="group" aria-label="Emergency group">
            <input type="radio" class="btn-check" name="task-emergency" id="emergency-low" autocomplete="off" checked="" value=1>
            <label class="btn btn-outline-danger" for="emergency-low" style="width: 80px;">Low</label>

            <input type="radio" class="btn-check" name="task-emergency" id="emergency-medium" autocomplete="off" value=2>
            <label class="btn btn-outline-danger" for="emergency-medium" style="width: 100px;">Medium</label>

            <input type="radio" class="btn-check" name="task-emergency" id="emergency-high" autocomplete="off" value=3>
            <label class="btn btn-outline-danger" for="emergency-high" style="width: 100px;">High</label>

            <input type="radio" class="btn-check" name="task-emergency" id="emergency-critical" autocomplete="off" value=4>
            <label class="btn btn-outline-danger" for="emergency-critical" style="width: 120px;">Critical</label>
          </div>

          <!-- Importance ÈÄâÊã© -->
          <label style="width: 120px" class="me-2">Importance</label>
          <div class="btn-group my-1" role="group" aria-label="Importance group">
            <input type="radio" class="btn-check" name="task-importance" id="importance-low" autocomplete="off" checked="" value=1>
            <label class="btn btn-outline-warning" for="importance-low" style="width: 80px;">Low</label>

            <input type="radio" class="btn-check" name="task-importance" id="importance-medium" autocomplete="off" value=2>
            <label class="btn btn-outline-warning" for="importance-medium" style="width: 100px;">Medium</label>

            <input type="radio" class="btn-check" name="task-importance" id="importance-high" autocomplete="off" value=3>
            <label class="btn btn-outline-warning" for="importance-high" style="width: 100px;">High</label>

            <input type="radio" class="btn-check" name="task-importance" id="importance-critical" autocomplete="off" value=4>
            <label class="btn btn-outline-warning" for="importance-critical" style="width: 120px;">Critical</label>
          </div>

          <!-- Difficulty ÈÄâÊã© -->
          <label style="width: 120px" class="me-2">Difficulty</label>
          <div class="btn-group my-1" role="group" aria-label="Difficulty group">
            <input type="radio" class="btn-check" name="task-difficulty" id="difficulty-easy" autocomplete="off" checked="" value=1>
            <label class="btn btn-outline-info" for="difficulty-easy" style="width: 80px;">Easy</label>

            <input type="radio" class="btn-check" name="task-difficulty" id="difficulty-medium" autocomplete="off" value=2>
            <label class="btn btn-outline-info" for="difficulty-medium" style="width: 100px;">Medium</label>

            <input type="radio" class="btn-check" name="task-difficulty" id="difficulty-hard" autocomplete="off" value=3>
            <label class="btn btn-outline-info" for="difficulty-hard" style="width: 100px;">Hard</label>

            <input type="radio" class="btn-check" name="task-difficulty" id="difficulty-very-hard" autocomplete="off" value=4>
            <label class="btn btn-outline-info" for="difficulty-very-hard" style="width: 120px;">Very Hard</label>
          </div>

          <!-- Estimated Time (‰ΩøÁî®ÈÄâÊã©Ê°ÜÂÆûÁé∞) -->
          <div class="mb-1 d-flex align-items-center">
            <label for="task-time" class="form-label me-2" style="width: 120px">Estimated Time</label>
            <select class="form-select w-auto my-1" id="task-time">
              <option value="15">15 ÂàÜÈíü</option>
              <option value="30">30 ÂàÜÈíü</option>
              <option value="60">1 Â∞èÊó∂</option>
              <option value="90">1.5 Â∞èÊó∂</option>
              <option value="120">2 Â∞èÊó∂</option>
            </select>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button type="button" id="modal-save-btn" class="btn btn-primary">Create</button>
      </div>
    </div>
  </div>
</div>


<!-- =========================================================== -->
<!-- JavaScriptÈÄªËæë -->
<!-- ÂºïÂÖ•BootstrapÁöÑJSÁªÑ‰ª∂ -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="{{ url_for('static', filename='js/command.js') }}"></script>
<script>

const commandManager = new CommandManager();

// ========================================================
// ÊéíÂ∫èÊñπÂêëÔºåÈªòËÆ§‰∏∫ÈôçÂ∫è
let unfinishedSortDirection = 'desc';
let finishedSortDirection = 'desc';
// ÊéíÂ∫èÂ±ûÊÄßÔºåÈªòËÆ§‰∏∫ 'created_at'
let unfinishedSortAttribute = 'created_at';
let finishedSortAttribute = 'created_at';
// ÊéíÂ∫è‰ªªÂä°
function sortTasks(listType, attribute, direction) {
  const taskList = document.getElementById(`${listType}-task-list`).querySelector('ul');
  const tasks = Array.from(taskList.children);  // Ëé∑ÂèñÊâÄÊúâ‰ªªÂä°ÁöÑ DOM ÂÖÉÁ¥†
  
  tasks.sort((a, b) => {
    let aValue = getTaskValue(a, attribute);
    let bValue = getTaskValue(b, attribute);

    // Â¶ÇÊûú‰∏ªÊéíÂ∫èÂ±ûÊÄßÁõ∏ÂêåÔºåÂàôËøõË°åÊ¨°Á∫ßÊéíÂ∫è
    if (aValue === bValue) {
      return secondarySort(a, b, direction);
    }

    return direction === 'desc' ? bValue - aValue : aValue - bValue;
  });

  // Ê∏ÖÁ©∫‰ªªÂä°ÂàóË°®Âπ∂ÈáçÊñ∞ÊåâÈ°∫Â∫èÊèíÂÖ•ÊéíÂ∫èÂêéÁöÑ‰ªªÂä°
  taskList.innerHTML = '';
  tasks.forEach(task => taskList.appendChild(task));
}
// Ëé∑Âèñ‰ªªÂä°ÁöÑÂ±ûÊÄßÂÄº
function getTaskValue(task, attribute) {
  if (attribute === 'created_at') {
    return new Date(task.querySelector('.created-at').textContent.replace('Created:', '')).getTime();
  } else if (attribute === 'emergency') {
    return task.querySelector('.emergency-symbol').textContent.length;  // Ê†πÊçÆüî•Êï∞ÈáèÂà§Êñ≠
  } else if (attribute === 'importance') {
    return task.querySelector('.importance-symbol').textContent.length;  // Ê†πÊçÆ‚≠êÊï∞ÈáèÂà§Êñ≠
  } else if (attribute === 'difficulty') {
    return task.querySelector('.difficulty-symbol').textContent.length;  // Ê†πÊçÆüîÆÊï∞ÈáèÂà§Êñ≠
  } else if (attribute === 'time') {
    return parseInt(task.querySelector('.accordion-time').textContent);  // È¢ÑËÆ°Êó∂Èó¥
  }
  return 0;
}
// Ê¨°Á∫ßÊéíÂ∫èÔºöEmerg > Import > Diffi > Esti Time > Creat At
function secondarySort(a, b, direction) {
  const attributes = ['emergency', 'importance', 'difficulty', 'time', 'created_at'];
  for (const attr of attributes) {
    let aValue = getTaskValue(a, attr);
    let bValue = getTaskValue(b, attr);

    if (aValue !== bValue) {
      return direction === 'desc' ? bValue - aValue : aValue - bValue;
    }
  }
  return 0;  // Â¶ÇÊûúÂÆåÂÖ®Áõ∏Âêå
}
// ÁÇπÂáªÊéíÂ∫èÊåâÈíÆ -- Â±ûÊÄß
document.querySelectorAll('.sort-btn').forEach(button => {
  button.addEventListener('click', function() {
    const listType = this.id.startsWith('unfinished') ? 'unfinished' : 'finished';
    const sortAttribute = this.getAttribute('data-sort');
    
    if (listType === 'unfinished') {
      unfinishedSortAttribute = sortAttribute;
      sortTasks('unfinished', unfinishedSortAttribute, unfinishedSortDirection);
    } else {
      finishedSortAttribute = sortAttribute;
      sortTasks('finished', finishedSortAttribute, finishedSortDirection);
    }
  });
});
// ÁÇπÂáªÊéíÂ∫èÊåâÈíÆ -- Ê≠£Â∫è/ÂÄíÂ∫è
document.querySelectorAll('.sort-direction').forEach(button => {
  button.addEventListener('click', function() {
    const listType = this.id.startsWith('unfinished') ? 'unfinished' : 'finished';
    
    if (listType === 'unfinished') {
      unfinishedSortDirection = unfinishedSortDirection === 'desc' ? 'asc' : 'desc';
      button.textContent = unfinishedSortDirection === 'desc' ? 'üîª' : 'üî∫';
      sortTasks('unfinished', unfinishedSortAttribute, unfinishedSortDirection);
    } else {
      finishedSortDirection = finishedSortDirection === 'desc' ? 'asc' : 'desc';
      button.textContent = finishedSortDirection === 'desc' ? 'üîª' : 'üî∫';
      sortTasks('finished', finishedSortAttribute, finishedSortDirection);
    }
  });
});

// ========================================================
// È°µÈù¢Âä†ËΩΩÊó∂
document.addEventListener('DOMContentLoaded', function () {
  const fetchTasksCommand = new FetchTasksCommand();
  commandManager.executeCommand(fetchTasksCommand);
})

// ÁÇπÂáªÂø´Êç∑ÂàõÂª∫‰ªªÂä° Add Task
document.getElementById('add-task').addEventListener('click', function() {
  // ÂîØ‰∏ÄÈúÄË¶ÅÊèê‰æõÁöÑÊòØ title
  const taskTitle = document.getElementById('task-title').value.trim();
  if (!taskTitle) {
    alert("ËØ∑Â°´ÂÜô‰ªªÂä°Ê†áÈ¢ò");
    return;
  }

  const task = {
    title: taskTitle,
    notes: '',
    emergency: 1,
    importance: 1,
    difficulty: 1,
    is_finished: false,
    created_at: new Date().toISOString(),
    estimated_time: 15,
  };
  const addTaskCommand = new AddTaskCommand(task);
  commandManager.executeCommand(addTaskCommand);
})

// Enter Âø´Êç∑ÂàõÂª∫‰ªªÂä°
document.getElementById('task-title').addEventListener('keydown', function(event) {
  if (event.key === 'Enter' || event.keyCode === 13) {
    event.preventDefault();  // ÈòªÊ≠¢Ë°®ÂçïÁöÑÈªòËÆ§Êèê‰∫§Ë°å‰∏∫
    document.getElementById('add-task').click();  // Toggle [Add Task] click
  }
})

// ÁÇπÂáªÂ±ïÂºÄËØ¶ÊÉÖÂàõÂª∫‰ªªÂä°
document.getElementById('toggle-details').addEventListener('click', function() {
  // Êõ¥Êñ∞ Modal ÁöÑÊ†áÈ¢òÂíåÊåâÈíÆ
  document.getElementById('task-modal-label').textContent = 'New Task';
  document.getElementById('modal-save-btn').textContent = 'Create';

  // ÊòæÁ§∫ Modal
  const taskModal = new bootstrap.Modal(document.getElementById('task-modal'));
  taskModal.show();

  // ËÆæÁΩÆ‰øùÂ≠òÊåâÈíÆÁöÑÂäüËÉΩ‰∏∫ÂàõÂª∫‰ªªÂä°
  document.getElementById('modal-save-btn').onclick = function() {
    const taskTitle = document.getElementById('modal-task-title').value.trim();
    if (!taskTitle) {
      alert("ËØ∑Â°´ÂÜô‰ªªÂä°Ê†áÈ¢ò");
      return;
    }
    const taskNotes = document.getElementById('task-notes').value.trim();
    const taskEmergency = Number(document.querySelector('input[name="task-emergency"]:checked').value);
    const taskImportance = Number(document.querySelector('input[name="task-importance"]:checked').value);
    const taskDifficulty = Number(document.querySelector('input[name="task-difficulty"]:checked').value);
    const taskEstimatedTime = Number(document.getElementById('task-time').value);

    const task = {
      title: taskTitle,
      notes: taskNotes,
      emergency: taskEmergency,
      importance: taskImportance,
      difficulty: taskDifficulty,
      estimated_time: taskEstimatedTime,
      is_finished: false,
      created_at: new Date().toISOString(),
    };

    const addTaskCommand = new AddTaskCommand(task);
    commandManager.executeCommand(addTaskCommand);

    // ÈöêËóè Modal
    const taskModal = bootstrap.Modal.getInstance(document.getElementById('task-modal'));
    taskModal.hide();
  };
})

// ÁÇπÂáªÂà†Èô§‰ªªÂä°
document.addEventListener('click', function(event) {
  if (event.target.classList.contains('delete-task')) {
    // Ëé∑Âæó‰ªªÂä°ÁöÑ id Ê≥®ÊÑèÈúÄË¶ÅËΩ¨Êç¢Á±ªÂûãÂê¶ÂàôÊó†Ê≥ïÊúâÊïàÂà†Èô§ IndexedDB ÁöÑÊï∞ÊçÆ
    const taskId = Number(event.target.getAttribute('data-task-id'));

    const confirmModal = new bootstrap.Modal(document.getElementById('modal-delete-confirm'));
    confirmModal.show();

    document.getElementById('confirm-delete-btn').onclick = function() {
      const deleteTaskCommand = new DeleteTaskCommand(taskId);
      commandManager.executeCommand(deleteTaskCommand);
      confirmModal.hide();
    }
  }
});

// ÁÇπÂáª‰øÆÊîπ‰ªªÂä°
document.addEventListener('click', function(event) {
  if (event.target.classList.contains('update-task')) {
    // Ëé∑Âæó‰ªªÂä°ÁöÑ id Ê≥®ÊÑèÈúÄË¶ÅËΩ¨Êç¢Á±ªÂûãÊâçËÉΩÁî®‰∫é IndexedDB
    const taskId = Number(event.target.getAttribute('data-task-id'));
    
    // ÊâæÂà∞‰ªªÂä° DOM ÂÖÉÁ¥†Âπ∂‰ªé‰∏≠Ëé∑Âèñ‰ø°ÊÅØ
    const listItem = document.querySelector(`#heading-${taskId}`);
    if (listItem) {
      // Êõ¥Êñ∞ Modal ÁöÑÊ†áÈ¢òÂíåÊåâÈíÆ
      document.getElementById('task-modal-label').textContent = 'Edit Task';
      document.getElementById('modal-save-btn').textContent = 'Save';

      // Ëé∑Âèñ Title
      const taskTitle = listItem.querySelector('.accordion-title').textContent;

      // Ëé∑Âèñ Emergency, Importance, Difficulty
      const taskEmergencySymbol = listItem.querySelector('.emergency-symbol').textContent;
      const taskImportanceSymbol = listItem.querySelector('.importance-symbol').textContent;
      const taskDifficultySymbol = listItem.querySelector('.difficulty-symbol').textContent;
      const taskEmergency = [...taskEmergencySymbol].length
      const taskImportance = [...taskImportanceSymbol].length
      const taskDifficulty = [...taskDifficultySymbol].length

      // Ëé∑Âèñ Estimated Time
      const taskEstimatedTime = Number(listItem.querySelector('.accordion-time').textContent.slice(0, -3));  // ÂéªÊéâ min

      // Ëé∑Âèñ Notes
      const collapseDiv = listItem.nextElementSibling;
      const taskNotes = collapseDiv.querySelector('p').textContent;

      // Â°´ÂÖÖË°®ÂçïÂÜÖÂÆπ
      document.getElementById('modal-task-title').value = taskTitle;
      document.getElementById('task-notes').value = taskNotes;
      document.querySelector(`input[name="task-emergency"][value="${taskEmergency}"]`).checked = true;
      document.querySelector(`input[name="task-importance"][value="${taskImportance}"]`).checked = true;
      document.querySelector(`input[name="task-difficulty"][value="${taskDifficulty}"]`).checked = true;
      document.getElementById('task-time').value = taskEstimatedTime;

      // ÊòæÁ§∫ Modal
      const taskModal = new bootstrap.Modal(document.getElementById('task-modal'));
      taskModal.show();

      // ÁÇπÂáª‰øùÂ≠òÊåâÈíÆÂàôÊõ¥Êñ∞‰ªªÂä°‰ø°ÊÅØ
      document.getElementById('modal-save-btn').onclick = function() {
        const taskData = {
          'title': document.getElementById('modal-task-title').value.trim(),
          'notes': document.getElementById('task-notes').value.trim(),
          'emergency': Number(document.querySelector('input[name="task-emergency"]:checked').value),
          'importance': Number(document.querySelector('input[name="task-importance"]:checked').value),
          'difficulty': Number(document.querySelector('input[name="task-difficulty"]:checked').value),
          'estimated_time': Number(document.getElementById('task-time').value),
        };

        // Êõ¥Êñ∞‰ªªÂä°‰ø°ÊÅØ
        const updateTaskCommand = new UpdateTaskCommand(taskId, taskData);
        commandManager.executeCommand(updateTaskCommand);

        // ÈöêËóè Modal
        taskModal.hide();
      };
    }

  }
})

// ÁÇπÂáªÂÆåÊàê‰ªªÂä°
document.addEventListener('click', function(event) {
  if (event.target.classList.contains('finish-task')) {
    // Ëé∑Âæó‰ªªÂä°ÁöÑ id Ê≥®ÊÑèÈúÄË¶ÅËΩ¨Êç¢Á±ªÂûã
    const taskId = Number(event.target.getAttribute('data-task-id'));
    const finishedAt = new Date().toISOString();
    const finishTaskCommand = new FinishTaskCommand(taskId, finishedAt);
    commandManager.executeCommand(finishTaskCommand);
  }
});


</script>

</body>