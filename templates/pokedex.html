<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pokémon Pokédex</title>
  <!-- Bootswatch Minty 主题 -->
  <link href="https://cdn.jsdelivr.net/npm/bootswatch@5.3.0/dist/minty/bootstrap.min.css" rel="stylesheet">
  <style>
    /* 自定义滚动条和布局样式 */
    .pokedex-sidebar {
      height: 100vh;
      /* 让侧边栏占满高度 */
      overflow-y: auto;
      /* 垂直滚动 */
      border-right: 1px solid #ccc;
      /* 添加分割线 */
    }

    .pokedex-sidebar .pokemon-thumbnail {
      padding: 10px;
      cursor: pointer;
    }

    .pokedex-sidebar .pokemon-thumbnail:hover {
      background-color: #e9ecef;
    }

    .pokedex-detail {
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .pokedex-image {
      max-width: 100%;
      height: auto;
    }

    /* 自定义卡片样式 */
    .pokemon-card {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding-left: 20px;
        padding-right: 250px;
        margin-bottom: 15px;
        border-radius: 10px;
        color: rgb(255, 255, 255);
    }

    .pokemon-card-info {
        display: flex;
        flex-direction: column;
        justify-content: center;
    }

    .pokemon-card-image {
        background-color: rgba(255, 255, 255, 0.2);
        padding: 10px;
        border-radius: 10px;
    }

    .pokemon-card img {
        max-width: 80px;
        height: auto;
    }
  </style>
</head>

<body>
<div class="container-fluid">
  <div class="row">
    <!-- 左侧滑动栏 -->
    <!-- <div class="col-3 pokedex-sidebar">
      <h5 class="text-center mt-3">Pokédex</h5>
      <div id="pokemon-list">
        <!- 在这里动态加载宝可梦缩略图 ->
      </div>
    </div> -->
    <div class="col-3 container mt-4">
      <h3 class="text-center mb-4">Pokédex</h3>
      <div id="pokemon-list">
          <!-- 在这里动态加载宝可梦卡片 -->
      </div>
    </div>

    <!-- 中间宝可梦详情 -->
    <div class="col-5">
      <div class="pokedex-detail text-center mt-4">
        <h3 id="pokemon-name" class="text-primary">请选择一个宝可梦</h3>
        <p id="pokemon-id" class="text-muted"></p>
        <p id="pokemon-type"></p>
      </div>
    </div>

    <!-- 右侧宝可梦图片和详细资料 -->
    <div class="col-4 text-center">
      <div class="pokedex-image-container mt-4">
        <img id="pokemon-image" class="pokedex-image" src="" alt="宝可梦图片">
      </div>
      <div id="pokemon-description" class="mt-3">
        <!-- 在这里加载宝可梦的描述等详细信息 -->
      </div>
    </div>
  </div>
</div>

<!-- Bootswatch Minty JS & Bootstrap -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<!-- 引入 Color Thief 用于提取图片颜色 -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/color-thief/2.3.0/color-thief.umd.js"></script>
<script>
  document.addEventListener('DOMContentLoaded', () => {
    const pokemonListElement = document.getElementById('pokemon-list');
    const pokemonNameElement = document.getElementById('pokemon-name');
    const pokemonIdElement = document.getElementById('pokemon-id');
    const pokemonTypeElement = document.getElementById('pokemon-type');
    const pokemonImageElement = document.getElementById('pokemon-image');
    const pokemonDescriptionElement = document.getElementById('pokemon-description');

    const colorThief = new ColorThief(); // 使用 Color Thief 库

    // 你的Supabase请求代码，假设你已经连接好Supabase
    fetch('/api/pokedex')
      .then(response => response.json())
      .then(pokemons => {
        // 动态加载宝可梦缩略图到左侧
        pokemons.forEach(pokemon => {
          // // === Method A. ===
          // const pokemonItem = document.createElement('div');
          // pokemonItem.classList.add('pokemon-thumbnail');
          // pokemonItem.innerHTML = `<strong>No.${String(pokemon.id).padStart(3, '0')}</strong> ${pokemon.name_cn}`;
          // pokemonItem.addEventListener('click', () => {
          //   // 当点击时，更新中间和右侧区域的信息
          //   pokemonNameElement.textContent = `${pokemon.name_cn} / ${pokemon.name_en}`;
          //   pokemonIdElement.textContent = `编号: #${pokemon.id}`;
          //   pokemonTypeElement.innerHTML = `类型: ${pokemon.type1}${pokemon.type2 ? `, ${pokemon.type2}` : ''}`;
          //   pokemonImageElement.src = `https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/${pokemon.id}.png`;
          //   pokemonDescriptionElement.textContent = "这里加载宝可梦描述信息。";  // 替换成实际的描述
          // });
          //
          // // 将生成的缩略图插入列表
          // pokemonListElement.appendChild(pokemonItem);


          // === Method B. ===
          const cardElement = document.createElement('div');
          cardElement.classList.add('col-md-4');
          const formattedId = String(pokemon.id).padStart(3, '0');
          const imgSrc = `static/imgs/${formattedId}.png`;
          //`{{ url_for('static', filename="imgs/${formattedId}.png") }}`

          // 卡片内容
          cardElement.innerHTML = `
            <div class="pokemon-card" id="pokemon-card-${pokemon.id}">
              <div class="pokemon-card-info">
                <strong>No.${String(pokemon.id).padStart(3, '0')}</strong>
                <span>${pokemon.name_cn}</span>
                <span class="text-muted">${pokemon.name_en}</span>
              </div>
              <div class="pokemon-card-image">
                <img id="pokemon-image-${pokemon.id}" src="${imgSrc}" alt="${pokemon.name_cn}">
              </div>
            </div>
          `;

          pokemonListElement.appendChild(cardElement);

          // 图片加载后提取颜色
          const imgElement = document.getElementById(`pokemon-image-${pokemon.id}`);
          imgElement.addEventListener('load', () => {
            if (imgElement.complete && imgElement.naturalHeight !== 0) {
              // 提取图片的主题色
              const color = colorThief.getColor(imgElement);
              const card = document.getElementById(`pokemon-card-${pokemon.id}`);
              card.style.backgroundColor = `rgb(${color[0]}, ${color[1]}, ${color[2]})`;
            }
          });


        });
      });

  });
</script>
</body>

</html>